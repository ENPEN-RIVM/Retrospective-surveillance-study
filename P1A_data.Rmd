---
title: "P1A data"
output: html_document
---

The goal of this document is to create tidy tables from the P1A, P2A and P3A datasets.To this end, I made a function at the end of this document, in the 4th piece of code, that will do exactly this. This saves some time and seems very organised. I can afford to do this, because I standardized the datasets in such a way, that they have the exact same format, the same number of columns, and the same number of rows. Therefore, the transformation I wish to do on the one, are the same I wish to do on the remaining two. Before we get started, we should load the necessary libraries.

On another note, this is a notebook file. It's the same extension as a markdown file, and practically does the same, the only is that every time you save this file, the HTML is updated (nice no?). Do note that in order to update the outputs of the code chunks into the HTML as well, you first need to run all the code, and only save after doing so.

As you can read in the README-pdf, the datasets P1A, P2A and P3A are relatively easy to understand. It's just an overview of total EV-tests/positives/attempted-to-type/succesfully-typed per country per year. First, we load the files:
```{r setup}
library(tidyverse)  
library(readxl)
library(xlsx)
```


```{r}
dataset_P1a <- read_excel("dummy_data.xlsx",.name_repair = "unique_quiet") 
```


```{r}
Create_tidytable <- function(df){                                 
  N_files    = nrow(df)-2 
  # first row is empty, second row is the column-names
  tidydf     = data.frame(matrix(ncol = 7, nrow = 6*N_files))   
  # I initiate an empty dataset with 7 columns and 6 rows for every lab.
  colnames(tidydf) = c("Country","Lab","Year","Tests","Positives","Typed_attempted","Typed_succesful") 
  for (yy in 1:6){
    # The data is from 2018-2023 (6 years)
    year_selection = df[,c((4*yy-1):(4*yy+2))]          
    # Columns 3,4,5,6 for 2023, 7,8,9,10 for 2022, etc. With yy being 1:6 the right indexing is (4*yy)-1 : (4*yy)+2
    year = year_selection[1,1]                        
    # Within this selection, the year is specified in the first column
    tidydf[c((yy-1)*N_files+1):(yy*N_files), c(4:7)] = year_selection[c(3:nrow(df)),]   
    # Filling all the rows with the right data
    tidydf[c((yy-1)*N_files+1):(yy*N_files),3] = year                                   
    # Filling empty column with the year
    tidydf[c((yy-1)*N_files+1):(yy*N_files),c(1,2)]= df[c(3:nrow(df)),c(1,2)]          
    # Filling empty columns country and Lab
    }
  tidydf = tidydf %>% arrange(Country,Lab,Year)
  return(tidydf)
}
```


```{r}
Tidy_P1a = Create_tidytable(dataset_P1a) 
write.table(Tidy_P1a,file="P1a_long.txt",sep=",",row.names = F)
```